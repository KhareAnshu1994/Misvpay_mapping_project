@using Mapping_Solution.Models;
@model IEnumerable<AddEmployeeDetails>

@{
    ViewBag.Title = "Add Employee Details";
    ViewBag.page_id = "49";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    .error {
        color: red;
    }

    #text1 {
        color: #ff0000;
        /*background: #ff0000;*/
    }

    #text2 {
        color: #ff0000;
    }

    #text3 {
        color: #ff0000;
    }

    #text4 {
        color: #ff0000;
    }
</style>

<div class="row">
    <div class="col-md-12">
        <h5>User Management</h5>
        <hr id="arn-master-firsthr">
        <div class="row">
            <div class="col-md-12">
                <table>
                    <tbody>
                        <tr>
                            <td>

                                <input type="file" id="myFile">
                            </td>
                            <td>
                                <input type="button" value="Upload" id="btnupload" class="btn btn-primary" onclick="upload()">
                            </td>
                        </tr>
                    </tbody>
                </table>
                <form id="addEmpDetailsForm">
                    <hr id="third-hr">
                    <div class="row pt-3">
                        <div class="form-group col-md-6 mb-3">
                            <label>Employee ID</label>
                            <input type="text" id="eid" name="Emp_Id" class="form-control" required>
                            <span class="error"></span>
                            @*<span id="text1"></span>*@
                        </div>
                        <div class="form-group col-md-6 mb-3">
                            <label>Employee Name </label>
                            <input type="text" id="ename" name="Emp_name" class="form-control" required>
                            @*<span id="text2"></span>*@
                            <span class="error"></span>
                        </div>
                        <div class="form-group col-md-6 mb-3">
                            <label>Email ID</label>
                            <input type="email" id="emailid" name="email_id" class="form-control" required>
                            @*<span id="text3"></span>*@
                            <span class="error"></span>
                        </div>
                        <div class="form-group col-md-6 mb-3">
                            <label>Password</label>
                            <input type="password" id="pass" name="pass" class="form-control" required>
                            <span class="error"></span>
                        </div>
                        <div class="form-group col-md-6 mb-3">
                            <label> Channel Code </label>
                            @Html.DropDownList("ChannelCode", ViewBag.channel as SelectList, "Select", new { @class = "form-select w-100", id = "ddlChannelCode" })

                            <span class="error"></span>
                        </div>
                        <div class="form-group col-md-6 mb-3">
                            <label> Employee Role </label>
                            @Html.DropDownList("EmployeeRole", ViewBag.EmpRole as SelectList, "Select", new { @class = "form-select", id = "ddlemployeerole" })
                            <span class="error"></span>
                        </div>
                        <hr class="mt-3">
                        <div class="form-group col-md-4 mb-3">
                            <label>Zone</label>
                            @Html.DropDownList("Zone", ViewBag.zone as SelectList, "Select", new { @class = "form-select", id = "ddlzone" })
                            <span class="error"></span>
                        </div>
                        <div class="form-group col-md-4 mb-3">
                            <label>Region</label>
                            @Html.DropDownList("Region", ViewBag.region as SelectList, "Select", new { @class = "form-select", id = "ddlRegion" })
                            <span class="error"></span>
                        </div>
                        <div class="form-group col-md-4 mb-3">
                            <label>Location/UFC</label>
                            @Html.DropDownList("Loaction_Ufc", ViewBag.Location as SelectList, "Select", new { @class = "form-select", id = "ddl_location" })
                            <span class="error"></span>
                        </div>
                        <div class="form-group col-md-4 mb-3">
                            <label>Functional Role</label>
                            @Html.DropDownList("FunctionalRole", ViewBag.Rolename as SelectList, "Select", new { @class = "form-select", id = "ddlFunctionalRole" })
                            <span class="error"></span>
                        </div>
                        @*<div class="form-group col-md-4 mb-3">
                                <label>City</label>
                                @Html.DropDownList("City", ViewBag.City as SelectList, "Select", new { @class = "form-select", id = "ddlCity" })
                            </div>*@
                        <div class="form-group col-md-4 mb-3">
                            <label>Start Date/Transfer Date</label>
                            <input type="date" id="startDate" name="start_Date" class="form-control">
                            <span class="error"></span>
                        </div>
                        <div class="form-group col-md-4 mb-3">
                            <label>End Date</label>
                            <input type="date" id="endDate" name="end_Date" class="form-control">
                            <span class="error"></span>
                        </div>
                        <div class="form-group col-md-4 mb-3">
                            <label>Status</label>
                            @Html.DropDownList("Status", ViewBag.Status as SelectList, "Select", new { @class = "form-select", id = "ddl_status" })
                            <span class="error"></span>
                        </div>
                        <div class="form-group col-md-4 mb-3">
                            <label>Type of Movement</label>
                            @Html.DropDownList("TypeOfMovement", ViewBag.Movement as SelectList, "Select", new { @class = "form-select", id = "Typesofmove" })
                            <span class="error"></span>
                        </div>
                        <div class="form-group col-md-4 mb-3">
                            <label>Select Quarter</label>
                            @Html.DropDownList("SelectQuarter", ViewBag.Quarter as SelectList, "Select", new { @class = "form-select", id = "ddlquarterselction" })
                            <span class="error"></span>
                        </div>
                        <div class="form-group col-md-4 mb-3">
                            <label>Valid From</label>
                            <input type="date" id="validFrom" name="valid_from" class="form-control">
                            <span class="error"></span>
                        </div>
                        <div class="form-group col-md-4 mb-3">
                            <label>Valid Upto</label>
                            <input type="date" id="validUpto" name="valid_upto" class="form-control">

                        </div>
                        <div class="form-group col-md-4 mb-3">
                            <label>HR Valid From</label>
                            <input type="date" id="hrValidFrom" name="hr_valid_from" class="form-control">
                            <span class="error"></span>
                        </div>
                        <div class="form-group col-md-4 mb-3">
                            <label>HR Valid Upto</label>
                            <input type="date" id="hrValidUpto" name="hr_valid_upto" class="form-control">
                            <span class="error"></span>
                        </div>
                        <div class="form-group col-md-8">
                            <label>Remark</label><textarea id="txtRemark" name="remark" class="form-control"></textarea>
                            <span class="error"></span>
                        </div>
                        <div class="col-md-12 mt-3 text-center">
                            @*<a href="#" id="btn_search" name="btnsearch" class="btn btn-primary" onclick="register()">Save</a>*@
                            @*<button id="btn_search" name="btnsearch" class="btn btn-primary" onclick="register()">Save</button>*@ <!--&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-->
                            <input type="button" value="Save" id="btn_search" name="btnsearch" class="btn btn-primary" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            <button type="reset" class="btn btn-primary">Cancel</button>
                            <a href="@Url.Action("Index","Main")" id="btn_search" name="btnsearch" class="btn btn-primary">Back</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>



<script>
    $('#ddlRegion').change(function () {

        var chanel = $('#ddlChannelCode').val();
        var region_code = $('#ddlRegion').val();
        var data = { region_code: region_code };
        $.ajax({
            url: "/MappingChangesAccess/GetUFCList",
            type: "POST",
            data: data,
            success: function (result) {
                $("#ddl_location").html("");
                console.log(result);
                if (result != null && result != undefined && result.length > 0) {
                    for (var i = 0; i < result.length; i++) {
                        var option = '<option value="' + result[i].ufc_code + '">' + result[i].ufc_name + '</option>';
                        $("#ddl_location").append(option);
                    }
                }
                $('#ddl_location').select('reload');
            },
            error: function (err) {
                console.error(err.message);
            },
        });

    })




    $('#btn_search').click(function () {

        $('#addEmpDetailsForm').validate({
            rules: {

                email_id: {
                    required: true,
                    email: true
                }

            }

        });


        var obj = {}

        var error = false;
        $(".error").html("");

        //Employee Id
        let Empid = $("#eid").val();
        if (Empid == "") {
            $('#eid').parent().find("span.error").html("Please Enter Employee Id*");
            error = true;

        }


        //Employee Name
        Ename = $("#ename").val();
        if (Ename == "") {
            $('#ename').parent().find("span.error").html("Please Enter Employee Name*");
            error = true;
        }


        //Email
        Email = $("#emailid").val();
        if (Email == "") {
            $('#emailid').parent().find("span.error").html("Required*");
            error = true;

        }

        //Password
        Pass = $("#pass").val();
        if (Pass == "") {
            $('#pass').parent().find("span.error").html("Required*");
            error = true;

        }


        // Channel Code
        let chnlcode = $("#ddlChannelCode").val();
        if (chnlcode == "") {
            $('#ddlChannelCode').parent().find("span.error").html("Required*");
            error = true;

        }


        //Employee Role
        let emrole = $("#ddlemployeerole").val();
        if (emrole == "") {
            $('#ddlemployeerole').parent().find("span.error").html("Required*");
            error = true;

        }


        //Zone
        let zone = $("#ddlzone").val();
        if (zone == "") {
            $('#ddlzone').parent().find("span.error").html("Required*");
            error = true;

        }


        //Region
        let region = $("#ddlRegion").val();
        if (region == "") {
            $('#ddlRegion').parent().find("span.error").html("Required*");
            error = true;

        }


        //Location
        let location = $("#ddl_location").val();
        if (location == "") {
            $('#ddl_location').parent().find("span.error").html("Required*");
            error = true;

        }


        //Functional Role
        let Role = $("#ddlFunctionalRole").val();
        if (Role == "") {
            $('#ddlFunctionalRole').parent().find("span.error").html("Required*");
            error = true;

        }


        //City
        //let city = $("#ddlCity").val();
        //if (city == "Select") {
        //    obj.City = null;
        //}
        //else {
        //    obj.City = city;
        //}

        //Start Date
        let startdate = $("#startDate").val();
        if (startdate == "") {
            $('#startDate').parent().find("span.error").html("Required*");
            error = true;

        }


        //End Date
        let enddate = $("#endDate").val();
        if (enddate == "") {
            $('#endDate').parent().find("span.error").html("Required*");
            error = true;

        }


        //Status
        let status = $("#ddl_status").val();
        if (status == "") {
            $('#ddl_status').parent().find("span.error").html("Required*");
            error = true;

        }

        //TYPE OF MOVEMENT
        let Typeofmove = $("#Typesofmove").val();
        if (Typeofmove == "") {
            $('#Typesofmove').parent().find("span.error").html("Required*");
            error = true;

        }



        //Select Quarter
        let quarter = $("#ddlquarterselction").val();
        if (quarter == "") {
            $('#ddlquarterselction').parent().find("span.error").html("Required*");
            error = true;

        }


        //Valid From
        // let validfrom = $("#validFrom").val();
        //obj.Valid_from = validfrom;

        //Valid Upto
        //let validupto = $("#validUpto").val();
        //obj.Valid_Upto = validupto;

        //Hr Valid From
        let hrvalidfrom = $("#hrValidFrom").val();
        if (hrvalidfrom == "") {
            $('#hrValidFrom').parent().find("span.error").html("Required*");
            error = true;

        }

        //Hr Valid Upto
        let hrvalidupto = $("#hrValidUpto").val();
        if (hrvalidupto == "") {
            $('#hrValidUpto').parent().find("span.error").html("Required*");
            error = true;

        }


        //Remqark
        remark = $("#txtRemark").val();

        if (error == false) {


            obj.EmployeeId = Empid;
            obj.EmployeeName = Ename;
            obj.EmailId = Email;
            obj.Password = Pass;
            obj.ChannelCode = chnlcode;
            obj.EmployeeRole = emrole;
            obj.Zone = zone;
            obj.Region = region;
            obj.Loaction_Ufc = location;
            obj.FunctionalRole = Role;
            obj.StartDate = startdate;
            obj.EndDate = enddate;
            obj.Status = status;
            obj.TypeOfMovement = Typeofmove;
            obj.SelectQuarter = quarter;
            obj.HR_Valid_From = hrvalidfrom;
            obj.HR_Valid_Upto = hrvalidupto;
            obj.Remark = remark;

            $.ajax({

                url: "/AddEmployeeDetails/Create",
                type: "POST",
                data: obj,
                success: function (data) {
                    alert(JSON.stringify(data.message));
                    window.location.reload();
                },
                error: function (err) {
                    console.error(err.message);
                },
            })
        }

    });




    function upload() {
        if (window.FormData !== undefined) {

            var fileUpload = $("#myFile").get(0);
            var files = fileUpload.files;

            var fileData = new FormData(); // Create FormData object

            // Looping over all files and add it to FormData object
            for (var i = 0; i < files.length; i++) {
                fileData.append(files[i].name, files[i]);
            }

            // Adding one more key to FormData object
            /* fileData.append("username", "Manas");*/

            $.ajax({
                url: "/AddEmployeeDetails/Upload",
                type: "POST",
                contentType: false, // Not to set any content header
                processData: false, // Not to process data
                data: fileData,
                success: function (result) {
                    alert(result);
                },
                error: function (err) {
                    alert(err.statusText);
                }
            });
        } else {
            alert("FormData is not supported.");
        }
    }
    //$(document).ready(function () {
    //    //function will be called on button click having id btnsave
    //    $("#btn_search").click(function () {
    //        $.ajax(
    //            {
    //                type: "POST", //HTTP POST Method
    //                url: "/AddEmployeeDetails/Create", // Controller/View
    //                data: { //Passing data
    //                    EmployeeId: $("#eid").val(), //Reading text box values using Jquery
    //                    EmployeeName: $("#ename").val(),
    //                    EmailId: $("#emailid").val(),
    //                    Password: $("#pass").val(),
    //                    ChannelCode: $("#ddlChannelCode").val(),
    //                    EmployeeRole: $("#ddlemployeerole").val(),
    //                    Zone: $("#ddlzone").val(),
    //                    Region: $("#ddlRegion").val(),
    //                    Loaction_Ufc: $("#ddl_location").val(),
    //                    FunctionalRole: $("#ddlFunctionalRole").val(),
    //                    City: $("#ddlCity").val(),
    //                    StartDate: $("#startDate").val(),
    //                    EndDate: $("#endDate").val(),
    //                    Status: $("#ddl_status").val(),
    //                    SelectQuarter: $("#ddlquarterselction").val(),
    //                    Valid_from: $("#validFrom").val(),
    //                    Valid_Upto: $("#validUpto").val(),
    //                    HR_Valid_From: $("#hrValidFrom").val(),
    //                    HR_Valid_Upto: $("#hrValidUpto").val(),
    //                    Remark: $("#txtRemark").val(),
    //                    TypeOfMovement: $("#Typesofmove").val(),
    //                },
    //                success: function (data) {
    //                    console.log(data);
    //                    alert(JSON.stringify(data.message));
    //                },
    //                error: function (err) {
    //                    console.error(err);
    //                },
    //            });
    //    });
    //});

</script>